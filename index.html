<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>SugarSync</title>
  <link rel="icon" type="image/png" href="Ahorro.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* üé® Estilo pastel */
    body {
      background-color: #fffafc;
      color: #333;
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .sidebar {
      width: 130px;
      background-color: #fde2e4;
      padding: 20px;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      display: flex;
      flex-direction: column;
      gap: 20px;
      border-right: 3px solid #fbc4ab;
    }
    .sidebar h2 {
      color: #6b2737;
      text-align: center;
    }
    .sidebar button {
      background-color: #fbc4ab;
      color: #6b2737;
      border: none;
      padding: 10px;
      cursor: pointer;
      border-radius: 5px;
      font-size: 15px;
      transition: background-color 0.3s;
    }
    .sidebar button:hover {
      background-color: #ffdab9;
    }
    .main-content {
      margin-left: 150px;
      padding: 20px;
      width: 100%;
      flex: 1;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background-color: #fff0f5;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(255, 182, 193, 0.5);
    }
    h1 {
      color: #e29578;
      text-align: center;
    }
    label, h3 {
      color: #6d6875;
    }
    input[type="number"], input[type="text"], input[type="date"], select {
      width: 100%;
      padding: 8px;
      margin: 6px 0 12px;
      border: 1px solid #ffcad4;
      border-radius: 6px;
      background-color: #fff;
    }
    .btn-center {
      display: flex;
      justify-content: center;
      margin-top: 10px;
      gap: 10px;
    }
    button {
      background-color: #fbc4ab;
      border: none;
      color: #6b2737;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    button:hover {
      background-color: #ffe5d9;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      margin-top: 20px;
      border-radius: 10px;
      overflow: hidden;
    }
    th, td {
      border: 1px solid #ffd6d6;
      padding: 10px;
      text-align: center;
      color: #444;
    }
    th {
      background-color: #fcd5ce;
    }
    td {
      background-color: #fff;
    }
    footer {
      text-align: center;
      padding: 15px;
      background-color: #fde2e4;
      color: #6b2737;
      font-size: 14px;
      border-top: 2px solid #fbc4ab;
    }
    #sugerencias {
      background: #ffe5d9;
      border-radius: 5px;
      padding: 5px;
      margin-top: -10px;
    }
    #sugerencias p {
      margin: 5px 0;
      padding: 5px;
      cursor: pointer;
    }
    #sugerencias p:hover {
      background: #fcd5ce;
    }
  </style>
</head>
<body>

  <div class="sidebar">
    <h2>Men√∫</h2>
    <button onclick="mostrarSeccion('inicio')">Inicio</button>
    <button onclick="mostrarSeccion('ventas')">Ventas</button>
    <button onclick="mostrarSeccion('graficas')">Gr√°ficas</button>
  </div>

  <div class="main-content">

    <!-- üè† Inicio -->
    <div class="container" id="inicio">
      <h1>üç¨ SugarSync üç≠</h1>
      <p>Bienvenido al sistema de registro y an√°lisis de ventas dulces.</p>

      <h3>Fecha de la venta</h3>
      <input type="date" id="fechaVenta" onchange="reiniciarNumeroVenta()">

      <h3>Registrar Venta</h3>
      <input type="text" id="nombreProducto" placeholder="Nombre del producto" oninput="mostrarSugerencias()">
      <div id="sugerencias"></div>
      <input type="number" id="cantidad" placeholder="Cantidad" min="1">
      <div class="btn-center">
        <button onclick="agregarProducto()">Agregar producto</button>
        <button onclick="finalizarVenta()">Finalizar venta</button>
      </div>
      <div id="mensaje"></div>

      <div id="ventaActual"></div>
      <h3 id="totalVenta" style="text-align:center; color:#6b2737;"></h3>
    </div>

    <!-- üßæ Ventas -->
    <div class="container" id="ventas" style="display:none;">
      <h2>Historial de Ventas</h2>
      <label for="fechaFiltro">Seleccionar fecha:</label>
      <select id="fechaFiltro" onchange="mostrarTabla()"></select>
      <div id="tablaCompras"></div>
    </div>

    <!-- üìä Gr√°ficas -->
    <div class="container" id="graficas" style="display:none;">
      <h2>Gr√°ficas de Ventas</h2>
      <label for="fechaGrafica">Seleccionar fecha:</label>
      <select id="fechaGrafica" onchange="mostrarGraficas()"></select>
      <canvas id="graficoProductos"></canvas>
      <canvas id="graficoVentas"></canvas>
    </div>

  </div>

  <footer>
    Creada por Dylan Tirado, Ismael Cadena, Angie Martinez y Deimar Chaverra
  </footer>

  <script>
    const productos = {
      "gansito": 2500, "chocorramo": 3000, "galleta festival": 1200,
      "galleta oreo": 1500, "jet": 1000, "bon bon bum": 600,
      "snickers": 2700, "ponymalta": 2500, "papas margarita": 2500,
      "detodito": 3000, "galleta ducales": 2000, "trululu": 1000,
      "gomitas fini": 2500, "agua cristal": 1500
    };

    let historial = [];
    let ventaActual = [];
    let numeroVenta = 1;
    let fechaActual = "";

    document.getElementById("fechaVenta").valueAsDate = new Date();
    fechaActual = document.getElementById("fechaVenta").value;

    function reiniciarNumeroVenta() {
      const nuevaFecha = document.getElementById("fechaVenta").value;
      if (nuevaFecha !== fechaActual) {
        fechaActual = nuevaFecha;
        const ventasDelDia = historial.filter(v => v.fecha === nuevaFecha);
        numeroVenta = ventasDelDia.length > 0 ? Math.max(...ventasDelDia.map(v => v.numeroVenta)) + 1 : 1;
      }
    }

    function actualizarFechas() {
      const fechas = [...new Set(historial.map(p => p.fecha))].sort();
      const fechaFiltro = document.getElementById("fechaFiltro");
      const fechaGrafica = document.getElementById("fechaGrafica");

      fechaFiltro.innerHTML = "";
      fechaGrafica.innerHTML = "";

      if (fechas.length === 0) {
        fechaFiltro.innerHTML = `<option>No hay fechas</option>`;
        fechaGrafica.innerHTML = `<option>No hay fechas</option>`;
        return;
      }

      fechas.forEach(f => {
        const opt1 = document.createElement("option");
        opt1.value = f;
        opt1.textContent = f;
        fechaFiltro.appendChild(opt1);

        const opt2 = document.createElement("option");
        opt2.value = f;
        opt2.textContent = f;
        fechaGrafica.appendChild(opt2);
      });
    }

    function mostrarSugerencias() {
      const entrada = document.getElementById('nombreProducto').value.toLowerCase();
      const contenedor = document.getElementById('sugerencias');
      contenedor.innerHTML = '';

      if (!entrada) return;

      Object.keys(productos).forEach(nombre => {
        if (nombre.includes(entrada)) {
          const precio = productos[nombre];
          const p = document.createElement('p');
          p.textContent = `${nombre} - $${precio.toLocaleString('es-CO')}`;
          p.onclick = () => {
            document.getElementById('nombreProducto').value = nombre;
            contenedor.innerHTML = '';
          };
          contenedor.appendChild(p);
        }
      });
    }

    function agregarProducto() {
      const nombre = document.getElementById('nombreProducto').value.trim().toLowerCase();
      const cantidad = parseInt(document.getElementById('cantidad').value);
      const mensaje = document.getElementById('mensaje');

      if (!productos[nombre]) {
        mensaje.innerHTML = `<p style="color:red">‚ùå Producto no encontrado.</p>`;
        return;
      }
      if (!cantidad || cantidad <= 0) {
        mensaje.innerHTML = `<p style="color:red">‚ùå Cantidad inv√°lida.</p>`;
        return;
      }

      const precio = productos[nombre];
      const total = precio * cantidad;
      ventaActual.push({ nombre, cantidad, precio, total });

      mensaje.innerHTML = `<p style="color:green">‚úÖ ${cantidad} ${nombre}(s) agregado(s)</p>`;
      document.getElementById('nombreProducto').value = '';
      document.getElementById('cantidad').value = '';

      mostrarVentaActual();
    }

    function mostrarVentaActual() {
      const cont = document.getElementById('ventaActual');
      if (ventaActual.length === 0) {
        cont.innerHTML = '<p>No hay productos agregados a√∫n.</p>';
        document.getElementById('totalVenta').textContent = '';
        return;
      }

      let html = `<table><tr><th>Producto</th><th>Cantidad</th><th>Precio</th><th>Total</th><th>Eliminar</th></tr>`;
      let totalVenta = 0;
      ventaActual.forEach((p, i) => {
        totalVenta += p.total;
        html += `<tr>
          <td>${p.nombre}</td>
          <td>${p.cantidad}</td>
          <td>$${p.precio.toLocaleString('es-CO')}</td>
          <td>$${p.total.toLocaleString('es-CO')}</td>
          <td><button onclick="eliminarProductoActual(${i})">X</button></td>
        </tr>`;
      });
      html += `</table>`;
      cont.innerHTML = html;
      document.getElementById('totalVenta').textContent = `üí∞ Total a pagar: $${totalVenta.toLocaleString('es-CO')}`;
    }

    function eliminarProductoActual(index) {
      ventaActual.splice(index, 1);
      mostrarVentaActual();
    }

    function finalizarVenta() {
      if (ventaActual.length === 0) {
        alert("No hay productos para finalizar la venta.");
        return;
      }

      const fecha = document.getElementById('fechaVenta').value;
      ventaActual.forEach(p => {
        historial.push({ fecha, numeroVenta, ...p });
      });

      document.getElementById('mensaje').innerHTML =
        `<p style="color:#6b2737">üí∞ Venta #${numeroVenta} del ${fecha} finalizada.</p>`;
      numeroVenta++;
      ventaActual = [];
      mostrarVentaActual();
      actualizarFechas();
    }

    function eliminarVenta(num, fecha) {
      if (confirm(`¬øEliminar venta #${num} del ${fecha}?`)) {
        historial = historial.filter(p => !(p.numeroVenta === num && p.fecha === fecha));
        mostrarTabla();
        mostrarGraficas();
        actualizarFechas();
      }
    }

    function mostrarTabla() {
      const fechaSeleccionada = document.getElementById('fechaFiltro').value;
      const tabla = document.getElementById('tablaCompras');
      const datos = historial.filter(p => p.fecha === fechaSeleccionada);

      if (datos.length === 0) {
        tabla.innerHTML = '<p>No hay ventas registradas para esta fecha.</p>';
        return;
      }

      let html = `<table><tr><th>N¬∞ Venta</th><th>Producto</th><th>Cant.</th><th>Precio</th><th>Total</th><th>Eliminar</th></tr>`;
      datos.forEach(p => {
        html += `<tr>
          <td>#${p.numeroVenta}</td>
          <td>${p.nombre}</td>
          <td>${p.cantidad}</td>
          <td>$${p.precio.toLocaleString('es-CO')}</td>
          <td>$${p.total.toLocaleString('es-CO')}</td>
          <td><button onclick="eliminarVenta(${p.numeroVenta}, '${p.fecha}')">X</button></td>
        </tr>`;
      });
      html += `</table>`;
      tabla.innerHTML = html;
    }

    function mostrarGraficas() {
      const fechaSeleccionada = document.getElementById('fechaGrafica').value;
      const ctx1 = document.getElementById('graficoProductos');
      const ctx2 = document.getElementById('graficoVentas');
      Chart.getChart(ctx1)?.destroy();
      Chart.getChart(ctx2)?.destroy();

      const datos = historial.filter(p => p.fecha === fechaSeleccionada);
      const productosVendidos = {};
      const cantidadesVendidas = {};
      const ventasTotales = {};

      datos.forEach(p => {
        productosVendidos[p.nombre] = (productosVendidos[p.nombre] || 0) + p.total;
        cantidadesVendidas[p.nombre] = (cantidadesVendidas[p.nombre] || 0) + p.cantidad;
        ventasTotales[p.numeroVenta] = (ventasTotales[p.numeroVenta] || 0) + p.total;
      });

      if (datos.length === 0) return;

      new Chart(ctx1, {
        type: 'bar',
        data: {
          labels: Object.keys(productosVendidos),
          datasets: [
            {
              label: 'Total Vendido ($)',
              data: Object.values(productosVendidos),
              backgroundColor: '#fbc4ab'
            },
            {
              label: 'Cantidad Vendida',
              data: Object.values(cantidadesVendidas),
              backgroundColor: '#bde0fe'
            }
          ]
        },
        options: { 
          scales: { y: { beginAtZero: true } },
          plugins: { legend: { labels: { color: '#6b2737' } } }
        }
      });

      new Chart(ctx2, {
        type: 'bar',
        data: {
          labels: Object.keys(ventasTotales).map(v => `Venta #${v}`),
          datasets: [{
            label: 'Total por Venta',
            data: Object.values(ventasTotales),
            backgroundColor: '#cdb4db'
          }]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });
    }

    function mostrarSeccion(seccion) {
      document.getElementById('inicio').style.display = seccion === 'inicio' ? 'block' : 'none';
      document.getElementById('ventas').style.display = seccion === 'ventas' ? 'block' : 'none';
      document.getElementById('graficas').style.display = seccion === 'graficas' ? 'block' : 'none';
      if (seccion === 'ventas') mostrarTabla();
      if (seccion === 'graficas') mostrarGraficas();
    }
  </script>
</body>
</html>
