<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>SugarSync</title>
  <link rel="icon" type="image/png" href="SugarSync.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #fffafc;
      color: #333;
      font-family: Arial, sans-serif;
      margin: 0;
    }

    .sidebar {
      width: 150px;
      background-color: #fde2e4;
      padding: 15px;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      display: flex;
      flex-direction: column;
      gap: 15px;
      border-right: 3px solid #fbc4ab;
    }

    .sidebar h2 {
      color: #6b2737;
      text-align: center;
    }

    .sidebar button {
      background-color: #fbc4ab;
      color: #6b2737;
      border: none;
      padding: 8px;
      cursor: pointer;
      border-radius: 5px;
    }

    .sidebar button:hover {
      background-color: #ffe5d9;
    }

    .main-content {
      margin-left: 170px;
      padding: 20px;
    }

    .container {
      background-color: #fff0f5;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      max-width: 900px;
      margin: auto;
    }

    h1 {
      text-align: center;
      color: #e29578;
    }

    input, select {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      border: 1px solid #ffcad4;
      border-radius: 6px;
    }

    button {
      background-color: #fbc4ab;
      border: none;
      color: #6b2737;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover { background-color: #ffe5d9; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: #fff;
    }

    th, td {
      border: 1px solid #ffd6d6;
      padding: 8px;
      text-align: center;
    }

    th { background-color: #fcd5ce; }

    footer {
      text-align: center;
      padding: 10px;
      background: #fde2e4;
      color: #6b2737;
      border-top: 2px solid #fbc4ab;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Men√∫</h2>
    <button onclick="mostrarSeccion('inicio')">Inicio</button>
    <button onclick="mostrarSeccion('ventas')">Ventas</button>
    <button onclick="mostrarSeccion('graficas')">Gr√°ficas</button>
  </div>

  <div class="main-content">
    <!-- INICIO -->
    <div class="container" id="inicio">
      <h1>üç¨ SugarSync üç≠</h1>
      <p>Registra las ventas del d√≠a y visualiza un resumen de tus productos vendidos.</p>

      <h3>Registrar venta</h3>
      <input type="date" id="fechaVenta">
      <input type="text" id="nombreProducto" placeholder="Nombre del producto">
      <input type="number" id="precioProducto" placeholder="Precio">
      <input type="number" id="cantidadProducto" placeholder="Cantidad">

      <button onclick="agregarProducto()">Agregar producto</button>
      <button onclick="finalizarVenta()">Finalizar venta</button>

      <div id="listaVenta"></div>
      <h3 id="totalVenta"></h3>
    </div>

    <!-- VENTAS -->
    <div class="container" id="ventas" style="display:none;">
      <h2>Historial de Ventas</h2>
      <select id="fechaFiltro" onchange="mostrarVentas()"></select>
      <div id="tablaVentas"></div>
    </div>

    <!-- GRAFICAS -->
    <div class="container" id="graficas" style="display:none;">
      <h2>Gr√°ficas de Ventas</h2>
      <select id="fechaGrafica" onchange="mostrarGraficas()"></select>
      <canvas id="graficoVentas"></canvas>
    </div>
  </div>

  <footer>
    Creado por Dylan Tirado, Audrick Fontecha, Camilo Garc√≠a y Miguel √Åvila
  </footer>

  <script>
    let historial = JSON.parse(localStorage.getItem('historial')) || [];
    let ventaActual = [];

    window.onload = () => {
      document.getElementById("fechaVenta").valueAsDate = new Date();
      actualizarFechas();
    };

    function agregarProducto() {
      const nombre = document.getElementById("nombreProducto").value.trim();
      const precio = parseInt(document.getElementById("precioProducto").value);
      const cantidad = parseInt(document.getElementById("cantidadProducto").value);

      if (!nombre || !precio || !cantidad) {
        alert("Por favor completa todos los campos");
        return;
      }

      const total = precio * cantidad;
      ventaActual.push({ nombre, precio, cantidad, total });
      mostrarVentaActual();
      document.getElementById("nombreProducto").value = "";
      document.getElementById("precioProducto").value = "";
      document.getElementById("cantidadProducto").value = "";
    }

    function mostrarVentaActual() {
      const cont = document.getElementById("listaVenta");
      if (ventaActual.length === 0) {
        cont.innerHTML = "<p>No hay productos agregados.</p>";
        document.getElementById("totalVenta").textContent = "";
        return;
      }

      let html = "<table><tr><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Total</th><th>Eliminar</th></tr>";
      let suma = 0;

      ventaActual.forEach((p, i) => {
        suma += p.total;
        html += `<tr>
                  <td>${p.nombre}</td>
                  <td>$${p.precio.toLocaleString('es-CO')}</td>
                  <td>${p.cantidad}</td>
                  <td>$${p.total.toLocaleString('es-CO')}</td>
                  <td><button onclick="eliminarProducto(${i})">X</button></td>
                </tr>`;
      });

      html += "</table>";
      cont.innerHTML = html;
      document.getElementById("totalVenta").textContent = "Total a pagar: $" + suma.toLocaleString('es-CO');
    }

    function eliminarProducto(i) {
      ventaActual.splice(i, 1);
      mostrarVentaActual();
    }

    function finalizarVenta() {
      const fecha = document.getElementById("fechaVenta").value;
      if (ventaActual.length === 0) {
        alert("No hay productos en la venta.");
        return;
      }

      ventaActual.forEach(p => historial.push({ fecha, ...p }));
      localStorage.setItem("historial", JSON.stringify(historial));

      ventaActual = [];
      mostrarVentaActual();
      actualizarFechas();
      alert("Venta guardada correctamente.");
    }

    function actualizarFechas() {
      const fechas = [...new Set(historial.map(v => v.fecha))];
      const selectVenta = document.getElementById("fechaFiltro");
      const selectGrafica = document.getElementById("fechaGrafica");

      selectVenta.innerHTML = "";
      selectGrafica.innerHTML = "";

      fechas.forEach(f => {
        selectVenta.innerHTML += `<option value="${f}">${f}</option>`;
        selectGrafica.innerHTML += `<option value="${f}">${f}</option>`;
      });
    }

    function mostrarVentas() {
      const fecha = document.getElementById("fechaFiltro").value;
      const datos = historial.filter(v => v.fecha === fecha);
      const tabla = document.getElementById("tablaVentas");

      if (datos.length === 0) {
        tabla.innerHTML = "<p>No hay ventas registradas para esta fecha.</p>";
        return;
      }

      let html = "<table><tr><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Total</th></tr>";
      datos.forEach(p => {
        html += `<tr>
                  <td>${p.nombre}</td>
                  <td>$${p.precio.toLocaleString('es-CO')}</td>
                  <td>${p.cantidad}</td>
                  <td>$${p.total.toLocaleString('es-CO')}</td>
                </tr>`;
      });
      html += "</table>";
      tabla.innerHTML = html;
    }

    function mostrarGraficas() {
      const fecha = document.getElementById("fechaGrafica").value;
      const datos = historial.filter(v => v.fecha === fecha);
      const ctx = document.getElementById("graficoVentas");

      Chart.getChart(ctx)?.destroy();

      const nombres = datos.map(d => d.nombre);
      const totales = datos.map(d => d.total);

      new Chart(ctx, {
        type: "bar",
        data: {
          labels: nombres,
          datasets: [{
            label: "Ventas ($)",
            data: totales,
            backgroundColor: "#fbc4ab"
          }]
        },
        options: {
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    function mostrarSeccion(sec) {
      document.getElementById("inicio").style.display = sec === "inicio" ? "block" : "none";
      document.getElementById("ventas").style.display = sec === "ventas" ? "block" : "none";
      document.getElementById("graficas").style.display = sec === "graficas" ? "block" : "none";
      if (sec === "ventas") mostrarVentas();
      if (sec === "graficas") mostrarGraficas();
    }
  </script>
</body>
</html>
