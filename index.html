<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Tienda de Golosinas üç¨</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #fff0f5;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #ff66b2;
      color: white;
      text-align: center;
      padding: 15px;
      font-size: 24px;
      letter-spacing: 1px;
    }

    nav {
      background-color: #ff99cc;
      padding: 10px;
      display: flex;
      justify-content: center;
      gap: 20px;
    }

    nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      transition: 0.3s;
    }

    nav a:hover {
      color: #ffe6f0;
    }

    .container {
      max-width: 1000px;
      background: white;
      margin: 30px auto;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    h2 {
      color: #e60073;
      text-align: center;
    }

    input, button {
      padding: 10px;
      margin: 5px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 15px;
    }

    input:focus {
      outline: none;
      border-color: #ff66b2;
      box-shadow: 0 0 5px #ff99cc;
    }

    button {
      background-color: #ff66b2;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    button:hover {
      background-color: #e60073;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #ffb3d9;
      color: #333;
    }

    .autocomplete-list {
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      max-height: 150px;
      overflow-y: auto;
      position: absolute;
      width: 92%;
      z-index: 10;
    }

    .autocomplete-item {
      padding: 8px;
      cursor: pointer;
    }

    .autocomplete-item:hover {
      background-color: #ffe6f0;
    }

    canvas {
      width: 100%;
      max-height: 300px;
      margin-top: 30px;
    }

    .delete-btn {
      background-color: #ff3366;
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
    }

    .delete-btn:hover {
      background-color: #cc0044;
    }
  </style>
</head>
<body>

  <header>üç≠ Tienda de Golosinas üç¨</header>

  <nav>
    <a href="#">Inicio</a>
    <a href="#">Ventas</a>
    <a href="#">Productos</a>
    <a href="#">Reportes</a>
  </nav>

  <div class="container">
    <h2>Registrar Venta</h2>
    <div style="position: relative;">
      <input type="text" id="nombreProducto" placeholder="Buscar producto...">
      <div id="sugerencias" class="autocomplete-list" style="display:none;"></div>
    </div>
    <input type="number" id="cantidad" placeholder="Cantidad" min="1">
    <button onclick="agregarProducto()">Agregar producto</button>
    <button onclick="finalizarVenta()">Finalizar venta</button>

    <div id="mensaje"></div>

    <div id="tablaCompras"></div>

    <h2>üìä Gr√°fico de Ventas por Producto</h2>
    <canvas id="graficoProductos"></canvas>

    <h2>üìà Gr√°fico de Ventas por N√∫mero de Venta</h2>
    <canvas id="graficoVentas"></canvas>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const productos = {
      "gansito": 2500, "chocorramo": 3000, "galleta festival": 1200,
      "jet": 1000, "bon bon bum": 600, "snickers": 2700,
      "ponymalta": 2500, "papas margarita": 2500, "detodito": 3000,
      "milky way": 2800, "galleta oreo": 1500, "trululu": 2300,
      "frunas": 400, "bubbaloo": 500, "milkybar": 2000, "doritos": 2500
    };

    let numeroVenta = 1;
    let historial = [];

    // --- Sugerencias de producto ---
    const inputProducto = document.getElementById("nombreProducto");
    const listaSugerencias = document.getElementById("sugerencias");

    inputProducto.addEventListener("input", () => {
      const texto = inputProducto.value.toLowerCase();
      listaSugerencias.innerHTML = "";
      if (!texto) {
        listaSugerencias.style.display = "none";
        return;
      }

      const filtrados = Object.keys(productos).filter(p => p.includes(texto));
      if (filtrados.length === 0) {
        listaSugerencias.style.display = "none";
        return;
      }

      listaSugerencias.style.display = "block";
      filtrados.forEach(p => {
        const item = document.createElement("div");
        item.classList.add("autocomplete-item");
        item.innerHTML = `${p} - $${productos[p].toLocaleString("es-CO")}`;
        item.onclick = () => {
          inputProducto.value = p;
          listaSugerencias.style.display = "none";
        };
        listaSugerencias.appendChild(item);
      });
    });

    // --- Agregar producto ---
    function agregarProducto() {
      const nombre = inputProducto.value.trim().toLowerCase();
      const cantidad = parseInt(document.getElementById("cantidad").value);
      const mensaje = document.getElementById("mensaje");

      if (!productos[nombre]) {
        mensaje.innerHTML = `<p style="color:red">‚ùå Producto no encontrado.</p>`;
        return;
      }
      if (!cantidad || cantidad <= 0) {
        mensaje.innerHTML = `<p style="color:red">‚ùå Cantidad inv√°lida.</p>`;
        return;
      }

      const precio = productos[nombre];
      const total = precio * cantidad;
      historial.push({ numeroVenta, nombre, cantidad, precio, total });

      mensaje.innerHTML = `<p style="color:green">‚úÖ ${cantidad} ${nombre}(s) agregado(s) a la venta #${numeroVenta}</p>`;
      inputProducto.value = "";
      document.getElementById("cantidad").value = "";

      mostrarTabla();
      mostrarGraficos();
    }

    // --- Finalizar venta ---
    function finalizarVenta() {
      numeroVenta++;
      document.getElementById("mensaje").innerHTML =
        `<p style="color:blue">üí∞ Venta finalizada. Nueva venta (#${numeroVenta}).</p>`;
    }

    // --- Eliminar una venta completa ---
    function eliminarVenta(num) {
      historial = historial.filter(p => p.numeroVenta !== num);
      mostrarTabla();
      mostrarGraficos();
      document.getElementById("mensaje").innerHTML =
        `<p style="color:red">üóëÔ∏è Venta #${num} eliminada.</p>`;
    }

    // --- Mostrar tabla ---
    function mostrarTabla() {
      const tabla = document.getElementById("tablaCompras");
      if (historial.length === 0) {
        tabla.innerHTML = "<p>No hay compras registradas.</p>";
        return;
      }

      let html = `<h3>Historial de Compras</h3>
      <table><tr><th>N¬∞ Venta</th><th>Producto</th><th>Cantidad</th><th>Precio Unitario</th><th>Total</th><th>Acci√≥n</th></tr>`;

      historial.forEach(p => {
        html += `<tr>
          <td>#${p.numeroVenta}</td>
          <td>${p.nombre}</td>
          <td>${p.cantidad}</td>
          <td>$${p.precio.toLocaleString("es-CO")}</td>
          <td>$${p.total.toLocaleString("es-CO")}</td>
          <td><button class="delete-btn" onclick="eliminarVenta(${p.numeroVenta})">Eliminar</button></td>
        </tr>`;
      });

      html += `</table>`;
      tabla.innerHTML = html;
    }

    // --- Mostrar gr√°ficos ---
    function mostrarGraficos() {
      const ctxProd = document.getElementById("graficoProductos");
      const ctxVenta = document.getElementById("graficoVentas");
      Chart.getChart(ctxProd)?.destroy();
      Chart.getChart(ctxVenta)?.destroy();

      // Gr√°fico por producto
      const productosMap = {};
      historial.forEach(p => {
        productosMap[p.nombre] = (productosMap[p.nombre] || 0) + p.total;
      });

      new Chart(ctxProd, {
        type: "bar",
        data: {
          labels: Object.keys(productosMap),
          datasets: [{
            label: "Ventas Totales por Producto",
            data: Object.values(productosMap),
            backgroundColor: "#ff99cc"
          }]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });

      // Gr√°fico por n√∫mero de venta
      const ventasMap = {};
      historial.forEach(p => {
        ventasMap[p.numeroVenta] = (ventasMap[p.numeroVenta] || 0) + p.total;
      });

      new Chart(ctxVenta, {
        type: "line",
        data: {
          labels: Object.keys(ventasMap),
          datasets: [{
            label: "Total por Venta",
            data: Object.values(ventasMap),
            borderColor: "#ff3385",
            fill: false,
            tension: 0.2
          }]
        },
        options: { scales: { y: { beginAtZero: true } } }
      });
    }
  </script>
</body>
</html>
