<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Tienda de Golosinas</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #ffe6f0, #fff);
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #ff4da6;
      color: white;
      text-align: center;
      padding: 20px 0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    h1 {
      margin: 0;
      font-size: 2.5em;
    }

    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }

    .contenedor {
      background: #fff;
      border-radius: 15px;
      padding: 25px;
      width: 90%;
      max-width: 900px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    input, button, datalist {
      padding: 10px;
      margin: 5px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1em;
    }

    button {
      background-color: #ff4da6;
      color: white;
      border: none;
      transition: 0.3s;
    }

    button:hover {
      background-color: #ff1a8c;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #ffe6f0;
    }

    #mensaje {
      margin-top: 15px;
      font-weight: 600;
    }

    canvas {
      width: 100%;
      max-height: 300px;
      margin-top: 30px;
    }

  </style>
</head>
<body>
  <header>
    <h1> Tienda de Golosinas üç≠</h1>
  </header>

  <main>
    <div class="contenedor">
      <h2>Registrar Venta</h2>
      <input list="listaProductos" id="nombreProducto" placeholder="Escribe el nombre del producto">
      <datalist id="listaProductos"></datalist>
      <input type="number" id="cantidad" placeholder="Cantidad" min="1">
      <button onclick="agregarProducto()">Agregar producto</button>
      <button onclick="finalizarVenta()">Finalizar venta</button>

      <div id="mensaje"></div>
      <div id="tablaCompras"></div>

      <canvas id="graficoVentas"></canvas>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // ======= Productos predefinidos =======
    const productos = {
      "gansito": 2500, "chocorramo": 3000, "galleta festival": 1200,
      "galleta oreo": 1500, "jet": 1000, "bon bon bum": 600, "milky way": 2800,
      "snickers": 2700, "milhoja": 3500, "chicle trident": 800, "chicle bubbaloo": 500,
      "ponymalta": 2500, "postobon manzana": 2000, "coca cola": 2500,
      "agua cristal": 1500, "papas margarita": 2500, "detodito": 3000,
      "platanitos": 2200, "galleta club social": 1500, "submarino": 2500,
      "arequipe alpina": 2000, "yogurt alpina": 2500, "bocadillo vele√±o": 800,
      "bocadillo con queso": 1500, "chocobreak": 1000, "chocoso": 1200,
      "chocojet": 1300, "quipitos": 900, "crispeta": 2000, "pirulin": 1800,
      "supercoco": 600, "bubaloo": 500, "menta": 300, "gomitas fini": 2500,
      "gomitas trululu": 2300, "barrilete": 1500, "galleta ducales": 2000,
      "galleta soda": 1500, "frunas": 400, "bocadillo rollo": 1000,
      "browni": 3000, "chocolate jet": 1200, "ponque ramo": 2800,
      "pastel gloria": 2700, "bocadillo ranchero": 800, "yupi": 1800,
      "galleta chokis": 2000, "choco krispis": 3500, "oreo doble crema": 1800,
      "nucita": 1200, "chocoboom": 1000, "milkybar": 2000, "m&m": 2500,
      "hersheys": 3000, "trululu": 1000, "barrilete surtido": 1600,
      "chocoramo mini": 1800, "galleta wafer": 1000, "chocolate corona": 1500,
      "yogurt kumis": 2300, "gomitas ositos": 2000, "jugo hit": 2200,
      "jugo del valle": 2000, "agua panela": 1200, "bocadillo lonja": 700,
      "manimoto": 1500, "mani salado": 1000, "mani japones": 1200,
      "mani dulce": 1200, "tostacos": 2500, "cheetos": 2500,
      "doritos": 2500, "lays": 2500, "tosti arepa": 2000, "achiras": 1500,
      "rosquitas": 1500, "ponque gala": 2800, "ponque choco gala": 3000,
      "alpinette": 3500, "maxibon": 4000, "chocorramo mini": 1800,
      "mermelada mora": 1800, "mermelada fresa": 1800, "colombina": 1000,
      "bombon": 600, "caramelo": 500, "tostones": 2000, "ponymalta mini": 1800,
      "ponymalta lata": 2500, "coca cola lata": 2500, "hit caja": 2000,
      "leche alpina": 2500, "almojabana": 2000, "empanada": 1800,
      "dona ramo": 3000, "brownie choco": 3500, "cereal bar": 2000,
      "chocolatina jet": 1200, "pan bimbo": 3500, "galleta festival mini": 1000
    };

    let numeroVenta = 1;
    let historial = [];

    // ======= Autocompletado din√°mico =======
    const inputProducto = document.getElementById('nombreProducto');
    const listaProductos = document.getElementById('listaProductos');

    inputProducto.addEventListener('input', () => {
      const texto = inputProducto.value.toLowerCase();
      listaProductos.innerHTML = '';
      if (texto.length === 0) return;

      Object.keys(productos)
        .filter(p => p.includes(texto))
        .forEach(nombre => {
          const option = document.createElement('option');
          option.value = nombre;
          option.textContent = `${nombre} - $${productos[nombre].toLocaleString('es-CO')}`;
          listaProductos.appendChild(option);
        });
    });

    // ======= Agregar producto =======
    function agregarProducto() {
      const nombre = inputProducto.value.trim().toLowerCase();
      const cantidad = parseInt(document.getElementById('cantidad').value);
      const mensaje = document.getElementById('mensaje');

      if (!productos[nombre]) {
        mensaje.innerHTML = `<p style="color:red">‚ùå Producto no encontrado.</p>`;
        return;
      }
      if (!cantidad || cantidad <= 0) {
        mensaje.innerHTML = `<p style="color:red">‚ùå Cantidad inv√°lida.</p>`;
        return;
      }

      const precio = productos[nombre];
      const total = precio * cantidad;
      historial.push({ numeroVenta, nombre, cantidad, precio, total });

      mensaje.innerHTML = `<p style="color:green">‚úÖ ${cantidad} ${nombre}(s) agregado(s) a la venta #${numeroVenta}</p>`;
      inputProducto.value = '';
      document.getElementById('cantidad').value = '';
      mostrarTabla();
      mostrarGrafico();
    }

    // ======= Finalizar venta =======
    function finalizarVenta() {
      numeroVenta++;
      document.getElementById('mensaje').innerHTML =
        `<p style="color:blue">üí∞ Venta #${numeroVenta - 1} finalizada. Nueva venta (#${numeroVenta}) iniciada.</p>`;
    }

    // ======= Mostrar tabla =======
    function mostrarTabla() {
      const tabla = document.getElementById('tablaCompras');
      if (historial.length === 0) {
        tabla.innerHTML = '<p>No hay compras registradas a√∫n.</p>';
        return;
      }

      let html = `<h3>Historial de Ventas</h3>
      <table><tr><th>N¬∞ Venta</th><th>Producto</th><th>Cantidad</th><th>Precio Unitario</th><th>Total</th></tr>`;

      historial.forEach(p => {
        html += `<tr>
          <td>#${p.numeroVenta}</td>
          <td>${p.nombre}</td>
          <td>${p.cantidad}</td>
          <td>$${p.precio.toLocaleString('es-CO')}</td>
          <td>$${p.total.toLocaleString('es-CO')}</td>
        </tr>`;
      });

      html += `</table>`;
      tabla.innerHTML = html;
    }

    // ======= Mostrar gr√°fico =======
    function mostrarGrafico() {
      const ctx = document.getElementById('graficoVentas');
      Chart.getChart(ctx)?.destroy();

      const nombres = [];
      const totales = [];

      historial.forEach(p => {
        const index = nombres.indexOf(p.nombre);
        if (index === -1) {
          nombres.push(p.nombre);
          totales.push(p.total);
        } else {
          totales[index] += p.total;
        }
      });

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: nombres,
          datasets: [{
            label: 'Ventas Totales por Producto',
            data: totales,
            backgroundColor: '#ff4da6'
          }]
        },
        options: {
          scales: { y: { beginAtZero: true } }
        }
      });
    }
  </script>
</body>
</html>
